#!/bin/bash
set -e

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞
script_dir=$(dirname "$(realpath "$0")")
src_dir="$script_dir/report"

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
current_dir=$(pwd)
if [ "$(basename "$current_dir")" = "report" ]; then
    dest_dir="$current_dir"
    operation_mode="–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏ report"
else
    dest_dir="$current_dir/report"
    operation_mode="–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –Ω–æ–≤—É—é –ø–∞–ø–∫—É report"
fi

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
RED='\033[1;31m'
BLUE='\033[1;34m'
NC='\033[0m' # No Color

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏—Å—Ö–æ–¥–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -d "$src_dir" ]; then
    echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –ò—Å—Ö–æ–¥–Ω–∞—è –ø–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: $src_dir${NC}" >&2
    echo -e "${YELLOW}‚ÑπÔ∏è  –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, —á—Ç–æ –∏ –ø–∞–ø–∫–∞ report${NC}"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
for item in Makefile scripts src; do
    if [ ! -e "$src_dir/$item" ]; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç: $src_dir/$item${NC}" >&2
        exit 1
    fi
done

echo -e "${BLUE}üìã –ù–∞—á–∞–ª–æ –æ–ø–µ—Ä–∞—Ü–∏–∏: $operation_mode${NC}"
echo -e "${BLUE}üì¶ –ò—Å—Ç–æ—á–Ω–∏–∫: ${src_dir}${NC}"
echo -e "${BLUE}üìÅ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: ${dest_dir}${NC}"
echo -e "${BLUE}‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ${NC}"

# –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
if [ ! -d "$dest_dir" ]; then
    mkdir -p "$dest_dir"
    echo -e "${YELLOW}üÜï –°–æ–∑–¥–∞–Ω–∞ —Ü–µ–ª–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: $dest_dir${NC}"
fi

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Makefile —Å –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é
echo -e "${BLUE}üìÑ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Makefile —Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é...${NC}"
cp -vf "$src_dir/Makefile" "$dest_dir/"

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ scripts —Å –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)
echo -e "${BLUE}üîÑ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ scripts —Å –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é...${NC}"
mkdir -p "$dest_dir/scripts"
cp -r --update=all -vf "$src_dir/scripts/"* "$dest_dir/scripts/" 2>/dev/null || true

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ src —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ (--update=none)
echo -e "${BLUE}üÜï –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ src (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã, –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏)...${NC}"
mkdir -p "$dest_dir/src"
cp -r --update=none -vf "$src_dir/src/"* "$dest_dir/src/" 2>/dev/null || true

echo -e "\n${GREEN}‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!${NC}"
echo -e "‚Ä¢ Makefile –∏ scripts: ${YELLOW}–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã${NC}"
echo -e "‚Ä¢ src: ${GREEN}–¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã${NC}"
echo -e "‚Ä¢ –†–µ–∑—É–ª—å—Ç–∞—Ç: ${dest_dir}"